{% extends "base.html" %}

{% block content %}


    <h1 align="center"> Finde eine spannende Tour für dich </h1>

    <!-- Alle Touren werden angezeigt -->

    <div class="col-10 mx-auto">

            
        <h2 class="col-8"> Übersicht der Startpunkte auf der Karte</h2>
            

        <div id="mapdiv" style="height:400px; width:100%;">&nbsp;</div>       

        <br/>

        <br/>

        <h2> Touren in deiner Nähe </h2>

        <div id="demo">
            <h2>Let AJAX change this text</h2>
          </div>


        <h2> Alle Touren auf einen Blick </h2>

        <div class="row">
            

            {% for t in touren %}
            
                <div class="card bg-dark text-white col-lg-4 col-md-6 p-3 border bg-light">
                    <div class="card-header">
                        <h3>Tour Titel</h3>
                    </div>
                    <img class="card-img" src="./../static/vorschaubilder/{{ touren[t] }}" alt="Card image">
                    <div class="card-footer">
                        <a href="/testRoute" class="btn btn-primary stretched-link">Mehr Details</a>
                    </div>
                </div>

            {% endfor %}

        </div>

    </div>

    
    <div id="target"></div>
    <button onclick="kb_source_2_target()">Hier klicken</button>



{% endblock %}

{% block scripts %}
<script src="http://www.openlayers.org/api/OpenLayers.js" type="text/javascript"></script>
<script>
    map = new OpenLayers.Map("mapdiv");
    map.addLayer(new OpenLayers.Layer.OSM());

    var positionLon = '';
    var positionLat = '';
    

    var lonLat = new OpenLayers.LonLat( 8.5166646, 53.0166666 ).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject() );

    navigator.geolocation.getCurrentPosition(
        function(position){
            // wenn Position ermittelt werden konnte, liefert
            //'position.coords.latitude' und 'position.coords.longitude'
            //die entsprechenden Längen- und Breitengrade
            lonLat = new OpenLayers.LonLat( position.coords.longitude, position.coords.latitude ).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject() );
            
            positionLon = position.coords.longitude;
            positionLat = position.coords.latitude;

            var zoom=12;
            map.setCenter (lonLat, zoom);


        }, 
        function () {
            // der zweite Funktionsteil wird ausgeführt, wenn keine
            //Positionsermittlung stattfinden konnte
            lonLat = new OpenLayers.LonLat( 8.7166646, 52.0166666 ).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject() // to Spherical Mercator Projection
            );

            positionLon = 8.7166646;
            positionLat = 52.0166666;

            var zoom=12;
            map.setCenter (lonLat, zoom);
    })
    
    

    

    

    var markers = new OpenLayers.Layer.Markers( "Markers" );
    map.addLayer(markers);
    var size = new OpenLayers.Size(25,25);
    var offset = new OpenLayers.Pixel(-(size.w/2), -size.h);
  

    
    /* einzelne Markierungen setzen */
    {% for k in koordinaten %}

        var lonLat_{{ k }} = new OpenLayers.LonLat( {{ koordinaten[k][0] }}, {{ koordinaten[k][1] }} )
            .transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject()   );
        var {{ k }} = new OpenLayers.Marker( lonLat_{{ k }} );
        {{ k }}.events.register("click", map, function(e) { location.href = "/testRoute"  });
        markers.addMarker({{ k }});


    {% endfor %}


    
    $.ajax({ url: '/routeoverview/tourenInNaehe', 
                            success: function (result) {
                                console.log(result);
                                $('#demo').html(result.name)
                        }});

/*
    const xhr = new XMLHttpRequest();
    xhr.addEventListener("load", function() {
    // Hier kommt die Antwort
    });
    xhr.open('GET', '/routeoverview/tourenInNaehe');
    xhr.send();
    var buildString = "<h1> Hier sind die nächsten 6 Routen </h1>"
    for (key in xhr)
    {
        buildString+="<p> Test </p>"+key
    }
    document.getElementById("demo").innerHTML = xhr.status + buildString;
    console.log(buildString);*/

    
    




    
    






    
</script>


{% endblock %}