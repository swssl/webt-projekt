{% extends "base.html" %}

{% block content %}


    <h1 align="center"> Finde eine spannende Tour für dich </h1>

    <!-- Alle Touren werden angezeigt -->

    <div class="col-10 mx-auto">

            
        <h2 class="col-8"> Übersicht der Startpunkte auf der Karte</h2>
            

        <div id="mapdiv" style="height:400px; width:100%;">&nbsp;</div>       

        <br/>

        <br/>

        <h2> Touren in deiner Nähe </h2>

        <div id="demo">
            <h2>Let AJAX change this text</h2>
            <button type="button" onclick="loadDoc()">Change Content</button>
          </div>


        <h2> Alle Touren auf einen Blick </h2>

        <div class="row">
            

            {% for t in touren %}
            
                <div class="card bg-dark text-white col-lg-4 col-md-6 p-3 border bg-light">
                    <div class="card-header">
                        <h3>Tour Titel</h3>
                    </div>
                    <img class="card-img" src="./../static/vorschaubilder/{{ touren[t] }}" alt="Card image">
                    <div class="card-footer">
                        <a href="/testRoute" class="btn btn-primary stretched-link">Mehr Details</a>
                    </div>
                </div>

            {% endfor %}

        </div>

    </div>

    



    <div>
        <span class="input-group-btn">
            <button class="btn btn-default" type="button" id="employee">
                Get Record</button>
        </span>
        <table id="content">
            <thead>
                <tr>
                    <th>
                        Id
                    </th>
                </tr>
            </thead>
            <tbody id="emp">
            </tbody>
        </table>
    </div>

{% endblock %}

{% block scripts %}
<script src="http://www.openlayers.org/api/OpenLayers.js"></script>
<script>
    map = new OpenLayers.Map("mapdiv");
    map.addLayer(new OpenLayers.Layer.OSM());

    var positionLon = '';
    var positionLat = '';
    

    var lonLat = new OpenLayers.LonLat( 8.5166646, 53.0166666 ).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject() );

    navigator.geolocation.getCurrentPosition(
        function(position){
            // wenn Position ermittelt werden konnte, liefert
            //'position.coords.latitude' und 'position.coords.longitude'
            //die entsprechenden Längen- und Breitengrade
            lonLat = new OpenLayers.LonLat( position.coords.longitude, position.coords.latitude ).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject() );
            
            positionLon = position.coords.longitude;
            positionLat = position.coords.latitude;

            var zoom=12;
            map.setCenter (lonLat, zoom);


        }, 
        function () {
            // der zweite Funktionsteil wird ausgeführt, wenn keine
            //Positionsermittlung stattfinden konnte
            lonLat = new OpenLayers.LonLat( 8.7166646, 52.0166666 ).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject() // to Spherical Mercator Projection
            );

            positionLon = 8.7166646;
            positionLat = 52.0166666;

            var zoom=12;
            map.setCenter (lonLat, zoom);
    })
    
    

    

    

    var markers = new OpenLayers.Layer.Markers( "Markers" );
    map.addLayer(markers);
    var size = new OpenLayers.Size(25,25);
    var offset = new OpenLayers.Pixel(-(size.w/2), -size.h);
  

    
    /* einzelne Markierungen setzen */
    {% for k in koordinaten %}

        var lonLat_{{ k }} = new OpenLayers.LonLat( {{ koordinaten[k][0] }}, {{ koordinaten[k][1] }} )
            .transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject()   );
        var {{ k }} = new OpenLayers.Marker( lonLat_{{ k }} );
        {{ k }}.events.register("click", map, function(e) { location.href = "/testRoute"  });
        markers.addMarker({{ k }});


    {% endfor %}


    //$.getJSON("/tourenInNaehe/"+positionLon+"/"+positionLat, function( data ) {
    $.getJSON("/", function( data ) {
    /*for(var key in data.routen){
         var out='<div class="card">';
              out+='<div class="card-header">'+data.articles[key].title+'</div>';
              out+='<img class="card-img-top" src="./../static/vorschaubilder/'+data.articles[key].pfad+'" alt="...">';

               out+='<div class="card-body">';
               //out+=data.articles[key].exerpt;
               out+='<div class="cls-for-load"></div>';
               //out+='<button class="btn btn-primary" onclick="$(this).parent().find(\'.cls-for-load\').load( \''+data.articles[key].url+'\');">more...</button>';
               out+='</div>';
               out+='</div>';*/
               var out = '<h1> Test </h1>'
            $('#demo').append(out);
    //}

});


    
    function loadDoc() {
  const xhttp = new XMLHttpRequest();
  xhttp.onload = function(data) {
      var out = "<h1>Beginn</h1>"
    for(var key in data){
         out+=""+key
    }
    document.getElementById("demo").innerHTML = out;
    }
  xhttp.open("GET", "/tourenInNaehe/"+positionLon+"/"+positionLat, true);
  xhttp.send();
}






$(function () {
        $("#employee").on("click", function () {
            $.ajax({
                url: "http://127.0.0.1:5000/tourenInNaehe/"+positionLon+"/"+positionLat,
                type: "POST",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    var json = JSON.parse(data.d);
                    $(json).each(function (index, item) {
                        var questionId = json[index].id;
                        var question = json[index].question;
                        var course = json[index].course;
                        for (var option = 0; option < json[index].answerEntities.length; option++) {
                            var ans = json[index].answerEntities[option].ans;
                            var ansId = json[index].answerEntities[option].id;
                            var ansStatus = json[index].answerEntities[option].status;
                            $('tbody#emp').append(
                            '<tr><td>'
                            + title
                            
                            + '</td></tr>')
                        }
                    });
                },
                error: function (data) { alert(data.responseText); }
            });
        });
    });
    
</script>


{% endblock %}